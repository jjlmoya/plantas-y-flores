---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import CalendarBreadcrumb from '../../../components/calendar/CalendarBreadcrumb.vue';
import HeaderExport from '../../../components/HeaderExport.vue';
import ScovilleCard from '../../../components/ScovilleCard.vue';
import PlantHeroHeader from '../../../components/calendar/PlantHeroHeader.vue';
import CalendarTimeline from '../../../components/calendar/CalendarTimeline.vue';
import PlantDetailsGrid from '../../../components/calendar/PlantDetailsGrid.vue';
import NutritionalInfo from '../../../components/calendar/NutritionalInfo.vue';
import HarvestDetails from '../../../components/calendar/HarvestDetails.vue';
import FlowerInfo from '../../../components/calendar/FlowerInfo.vue';
import { getPlantCalendarWithUI, getGlobalCalendarConfig, getUIHelpers, generatePlantPaths, getOriginFlag, getAvailableCalendarCategories } from '../../../utils/calendar-inheritance.js';
import { generatePlantCalendarSchema } from '../../../schemas/calendar/calendar.plant.schema.js';

// Generate static paths for all plants
export async function getStaticPaths() {
  try {
    const plantPaths = await generatePlantPaths();
    
    const result = plantPaths.map(({ params, props }) => ({
      params: { 
        category: params.category,
        plant: params.plant
      },
      props
    }));
    
    return result;
  } catch (error) {
    console.error('Error in getStaticPaths for plants:', error);
    return [];
  }
}

const { category, plant: plantSlug } = Astro.params;

if (!category || !plantSlug) {
  return Astro.redirect('/calendario/');
}

// Get plant calendar data with UI helpers
const plantCalendar = await getPlantCalendarWithUI(category, plantSlug);
const globalConfig = await getGlobalCalendarConfig();
const ui = getUIHelpers(globalConfig);
const availableCategories = await getAvailableCalendarCategories();

if (!plantCalendar || !plantCalendar._inheritance.has_plant_specific && !plantCalendar._inheritance.has_category) {
  return Astro.redirect('/calendario/');
}

const categoryName = ui.formatCategoryName(category);
const plantIndividualName = ui.formatPlantName(plantSlug);
const plantName = `${categoryName} ${plantIndividualName}`;
const categoryIcon = ui.getCategoryIcon(category);

// Process calendar data for timeline view
const timelineData = [];

// Generate 12-month timeline
for (let month = 1; month <= 12; month++) {
  const monthData = {
    month,
    monthName: ui.getMonthName(month),
    activities: []
  };

  const calendar = plantCalendar.calendar_data || {};

  // Check sowing activities
  if (calendar.sowing) {
    if (calendar.sowing.indoor?.best_months?.includes(month)) {
      monthData.activities.push({
        type: 'sowing',
        subtype: 'indoor',
        label: 'Siembra Interior',
        color: ui.getActivityColor('sowing'),
        icon: ui.getTaskIcon('prepare_seedbeds'),
        details: calendar.sowing.indoor.temperature_range ? 
          `${calendar.sowing.indoor.temperature_range[0]}-${calendar.sowing.indoor.temperature_range[1]}¬∞C` : null
      });
    }
    
    if (calendar.sowing.outdoor?.best_months?.includes(month)) {
      monthData.activities.push({
        type: 'sowing',
        subtype: 'outdoor',
        label: 'Siembra Exterior',
        color: ui.getActivityColor('sowing'),
        icon: ui.getTaskIcon('prepare_seedbeds'),
        details: calendar.sowing.outdoor.temperature_range ? 
          `${calendar.sowing.outdoor.temperature_range[0]}-${calendar.sowing.outdoor.temperature_range[1]}¬∞C` : null
      });
    }
  }

  // Check transplanting
  if (calendar.transplanting?.best_months?.includes(month)) {
    monthData.activities.push({
      type: 'transplanting',
      label: 'Trasplante',
      color: ui.getActivityColor('transplanting'),
      icon: ui.getTaskIcon('transplant'),
      details: calendar.transplanting.soil_temperature_min ? 
        `Suelo min: ${calendar.transplanting.soil_temperature_min}¬∞C` : null
    });
  }

  // Check harvesting
  if (calendar.harvesting?.best_months?.includes(month)) {
    const isPeak = calendar.harvesting.peak_months?.includes(month);
    monthData.activities.push({
      type: 'harvesting',
      label: isPeak ? 'Cosecha Principal' : 'Cosecha',
      color: ui.getActivityColor('harvesting'),
      icon: ui.getTaskIcon(isPeak ? 'harvest_main' : 'harvest_early'),
      priority: isPeak ? 'high' : 'medium',
      details: calendar.harvesting.days_to_harvest ? 
        `${calendar.harvesting.days_to_harvest[0]}-${calendar.harvesting.days_to_harvest[1]} d√≠as` : null
    });
  }

  // Check flowering (for perennials)
  if (calendar.flowering?.best_months?.includes(month)) {
    const isPeak = calendar.flowering.peak_months?.includes(month);
    monthData.activities.push({
      type: 'flowering',
      label: isPeak ? 'Floraci√≥n Principal' : 'Floraci√≥n',
      color: ui.getActivityColor('flowering'),
      icon: ui.getTaskIcon('enjoy_blooms'),
      priority: isPeak ? 'high' : 'medium'
    });
  }

  // Check planting (for perennials)
  if (calendar.planting?.best_months?.includes(month)) {
    monthData.activities.push({
      type: 'planting',
      label: 'Plantaci√≥n',
      color: ui.getActivityColor('planting'),
      icon: ui.getTaskIcon('prepare_beds')
    });
  }

  // Check monthly tasks (avoid duplicating planting, sowing if already added)
  const monthlyTasks = calendar.care_calendar?.monthly_tasks?.[month.toString()];
  if (monthlyTasks && monthlyTasks.length > 0) {
    // Get already added activity types and subtypes to avoid duplicates
    const existingTypes = monthData.activities.map(a => a.type);
    const existingSubtypes = monthData.activities.map(a => a.subtype).filter(Boolean);
    
    monthlyTasks.forEach(task => {
      // Skip planting task if we already added a planting activity
      if (task === 'planting' && existingTypes.includes('planting')) {
        return;
      }
      
      // Skip sowing tasks if we already added the specific sowing type
      if ((task === 'sowing_indoor' || task === 'sow_indoor') && existingSubtypes.includes('indoor')) {
        return;
      }
      if ((task === 'sowing_outdoor' || task === 'sow_outdoor') && existingSubtypes.includes('outdoor')) {
        return;
      }
      
      // Skip general sowing if we already have any sowing activity
      if (task === 'sowing' && existingTypes.includes('sowing')) {
        return;
      }
      
      // Skip harvesting tasks if we already have general harvesting
      if ((task === 'harvest_winter' || task === 'harvest_summer' || task === 'harvest_early') && existingTypes.includes('harvesting')) {
        return;
      }
      
      // Skip transplanting task if we already added a transplanting activity
      if (task === 'transplant' && existingTypes.includes('transplanting')) {
        return;
      }
      
      // Skip planting tasks if we already have sowing (they're similar)
      if (task === 'planting' && existingTypes.includes('sowing')) {
        return;
      }
      
      monthData.activities.push({
        type: 'care',
        label: ui.formatTaskName(task),
        color: ui.getActivityColor('care'),
        icon: ui.getTaskIcon(task),
        priority: ui.getTaskPriority(task)
      });
    });
  }

  timelineData.push(monthData);
}

// Group plant info
const plantInfo = {
  scientific_name: plantCalendar.plant_info?.scientific_name,
  common_names: plantCalendar.plant_info?.common_names,
  origin: plantCalendar.plant_info?.origin,
  type: plantCalendar.plant_info?.type,
  difficulty: plantCalendar.plant_info?.difficulty,
  family: plantCalendar.plant_info?.family
};

const growingConditions = plantCalendar.growing_conditions || {};
const harvestData = plantCalendar.harvest_data || {};
const nutritionalData = plantCalendar.nutritional_data || {};
const flowerData = plantCalendar.flower_data || {};
const scovilleData = plantCalendar.scoville_data || null;

// Article link
const articleLink = plantCalendar._article_links?.resolved_link;

// Translate companion plant names from English to Spanish and check if they have categories
function translateAndCheckCompanionPlants(companions) {
  const translations = {
    'muscari': 'Muscari',
    'narcisos': 'Narcisos', 
    'crocus': 'Crocus',
    'daffodils': 'Narcisos',
    'snowdrops': 'Campanillas de Invierno',
    'allium': 'Allium',
    'hyacinth': 'Jacinto',
    'iris': 'Iris',
    'fritillaria': 'Fritilaria',
    'scilla': 'Escila',
    'chionodoxa': 'Gloria de las Nieves',
    'galanthus': 'Campanilla de Invierno',
    'narcissus': 'Narciso',
    'basil': 'albahaca',
    'tomato': 'tomate',
    'rose': 'rosa',
    'lavender': 'lavanda',
    'thyme': 'tomillo',
    'chamomile': 'manzanilla',
    'strawberry': 'fresa',
    'chilli': 'chili',
    'potato': 'patata',
    'cabbage': 'col',
    'orchid': 'orquidea',
    'tulip': 'tulipan',
    'hibiscus': 'hibiscus',
    'lily': 'lirios',
    'mango': 'mango',
    'banana': 'pl√°tano',
    'pineapple': 'pi√±a',
    'pina': 'pi√±a',
    // Traducciones faltantes para companions
    'cotton': 'algod√≥n',
    'maize': 'ma√≠z',
    'corn': 'ma√≠z', 
    'legumes': 'leguminosas',
    'rosemary': 'romero',
    'sage': 'salvia',
    'onion': 'cebolla',
    'garlic': 'ajo',
    'celery': 'apio',
    'parsley': 'perejil',
    'oregano': 'or√©gano',
    'mint': 'menta',
    'dill': 'eneldo',
    'chives': 'cebollino',
    'walnut': 'nogal',
    'fennel': 'hinojo',
    'borage': 'borraja',
    'marigold': 'margarita',
    'petunia': 'petunia',
    'nasturtium': 'capuchina'
  };
  
  if (!companions || !Array.isArray(companions)) return [];
  
  return companions.map(companion => {
    const translatedName = translations[companion.toLowerCase()] || companion;
    const categoryExists = availableCategories.includes(translatedName.toLowerCase());
    
    return {
      originalName: companion,
      translatedName: translatedName,
      hasCategory: categoryExists,
      categorySlug: categoryExists ? translatedName.toLowerCase() : null
    };
  });
}

const processedCompanions = translateAndCheckCompanionPlants(growingConditions.companion_plants);
const processedAvoidPlants = translateAndCheckCompanionPlants(growingConditions.avoid_plants);

// Generate dynamic Schema FAQ based on plant data
function generateSchemaFAQ() {
  const faq = [];
  const calendar = plantCalendar.calendar_data || {};

  // Universal planting/sowing question - adapts to any plant type
  const hasPlanting = calendar.planting?.best_months;
  const hasSowing = calendar.sowing?.indoor?.best_months || calendar.sowing?.outdoor?.best_months || calendar.sowing?.best_months;
  
  if (hasPlanting || hasSowing) {
    let months = [];
    let verb = "";
    let details = "";
    
    if (hasPlanting) {
      months = calendar.planting.best_months;
      verb = "se planta";
      if (calendar.planting.soil_temperature_max) {
        details += `, cuando la temperatura del suelo est√© por debajo de ${calendar.planting.soil_temperature_max}¬∞C`;
      }
      if (calendar.planting.soil_temperature_min) {
        details += `, cuando la temperatura del suelo est√© por encima de ${calendar.planting.soil_temperature_min}¬∞C`;
      }
      if (calendar.planting.planting_depth) {
        details += `. Plantar a una profundidad de ${calendar.planting.planting_depth}`;
      }
    } else if (hasSowing) {
      // Handle sowing (seeds)
      if (calendar.sowing.indoor?.best_months) {
        months.push(...calendar.sowing.indoor.best_months);
      }
      if (calendar.sowing.outdoor?.best_months) {
        months.push(...calendar.sowing.outdoor.best_months);
      }
      if (calendar.sowing.best_months) {
        months.push(...calendar.sowing.best_months);
      }
      verb = "se siembra";
      
      if (calendar.sowing.indoor?.temperature_range || calendar.sowing.outdoor?.temperature_range) {
        const tempRange = calendar.sowing.indoor?.temperature_range || calendar.sowing.outdoor?.temperature_range;
        details += `, con temperatura √≥ptima entre ${tempRange[0]}-${tempRange[1]}¬∞C`;
      }
    }
    
    const uniqueMonths = [...new Set(months)].sort();
    const monthNames = uniqueMonths.map(m => ui.getMonthName(m));
    
    let answer = `${plantName} ${verb} `;
    if (monthNames.length <= 2) {
      answer += `en ${monthNames.join(' y ')}`;
    } else {
      answer += `desde ${monthNames[0]} hasta ${monthNames[monthNames.length - 1]}`;
    }
    
    answer += details;
    
    faq.push({
      question: `¬øCu√°ndo ${hasPlanting ? 'plantar' : 'sembrar'} ${plantName}?`,
      answer: answer
    });
  }


  // Universal flowering/harvesting question - adapts to any plant type
  if (calendar.flowering?.best_months) {
    const floweringMonths = calendar.flowering.best_months.map(m => ui.getMonthName(m));
    let answer = `${plantName} florece `;
    if (floweringMonths.length <= 2) {
      answer += `en ${floweringMonths.join(' y ')}`;
    } else {
      answer += `desde ${floweringMonths[0]} hasta ${floweringMonths[floweringMonths.length - 1]}`;
    }
    
    if (calendar.flowering.peak_months) {
      const peakMonths = calendar.flowering.peak_months.map(m => ui.getMonthName(m));
      answer += `, con floraci√≥n m√°s intensa en ${peakMonths.join(' y ')}`;
    }
    
    if (flowerData?.bloom_duration) {
      answer += `. La floraci√≥n dura aproximadamente ${flowerData.bloom_duration}`;
    }
    
    faq.push({
      question: `¬øCu√°ndo florece ${plantName}?`,
      answer: answer
    });
  }

  // Universal harvesting question - for any plant with harvest data
  if (calendar.harvesting?.best_months) {
    const harvestMonths = calendar.harvesting.best_months.map(m => ui.getMonthName(m));
    let answer = `La cosecha de ${plantName} se realiza `;
    if (harvestMonths.length <= 2) {
      answer += `en ${harvestMonths.join(' y ')}`;
    } else {
      answer += `desde ${harvestMonths[0]} hasta ${harvestMonths[harvestMonths.length - 1]}`;
    }
    
    if (calendar.harvesting.days_to_harvest) {
      const days = calendar.harvesting.days_to_harvest;
      answer += `, aproximadamente entre ${days[0]}-${days[1]} d√≠as despu√©s de la siembra`;
    }
    
    if (harvestData?.harvest_indicators?.length > 0) {
      const indicators = harvestData.harvest_indicators.map(ind => ui.formatTaskName(ind));
      answer += `. Indicadores de cosecha: ${indicators.join(', ')}.`;
    }
    
    faq.push({
      question: `¬øCu√°ndo cosechar ${plantName}?`,
      answer: answer
    });
  }

  // Universal transplanting question - for any plant with transplant data  
  if (calendar.transplanting?.best_months) {
    const transplantMonths = calendar.transplanting.best_months.map(m => ui.getMonthName(m));
    let answer = `${plantName} se trasplanta `;
    if (transplantMonths.length <= 2) {
      answer += `en ${transplantMonths.join(' y ')}`;
    } else {
      answer += `desde ${transplantMonths[0]} hasta ${transplantMonths[transplantMonths.length - 1]}`;
    }
    
    if (calendar.transplanting.soil_temperature_min) {
      answer += `, cuando el suelo alcance al menos ${calendar.transplanting.soil_temperature_min}¬∞C`;
    }
    
    answer += '. Es importante esperar a que las pl√°ntulas tengan el tama√±o adecuado y hayan pasado las √∫ltimas heladas.';
    
    faq.push({
      question: `¬øCu√°ndo trasplantar ${plantName}?`,
      answer: answer
    });
  }

  // Care/maintenance question if monthly tasks exist
  const hasCareTasks = Object.values(calendar.care_calendar?.monthly_tasks || {}).some(tasks => tasks.length > 0);
  if (hasCareTasks) {
    let answer = `${plantName} requiere cuidados espec√≠ficos seg√∫n la √©poca: `;
    
    const careByMonth = Object.entries(calendar.care_calendar?.monthly_tasks || {})
      .filter(([_, tasks]) => tasks.length > 0)
      .map(([month, tasks]) => ({
        month: ui.getMonthName(parseInt(month)),
        tasks: tasks.map(task => ui.formatTaskName(task)).join(', ')
      }));
    
    if (careByMonth.length > 0) {
      answer += careByMonth.slice(0, 3).map(care => 
        `${care.month}: ${care.tasks}`
      ).join('; ');
      
      if (careByMonth.length > 3) {
        answer += '. Otros cuidados var√≠an seg√∫n el mes espec√≠fico.';
      }
    }
    
    faq.push({
      question: `¬øQu√© cuidados necesita ${plantName}?`,
      answer: answer
    });
  }

  return faq;
}

const schemaFAQ = generateSchemaFAQ();

// Prepare export data
const plantExportData = {
  plantName,
  timelineData
};
---

<BaseLayout 
  title={`Calendario de cultivo del ${plantName.toLowerCase()} ${new Date().getFullYear()}: siembra, trasplante y cosecha`}
  description={`üå± Gu√≠a completa de cultivo para ${plantName}. Calendario detallado con fechas de siembra, trasplante y cosecha. ${plantInfo.scientific_name ? `${plantInfo.scientific_name}. ` : ''}Aprende cu√°ndo y c√≥mo cultivar ${plantName} paso a paso.`}
  keywords={`${plantName}, cultivo ${plantName}, calendario ${plantName}, plantar ${plantName}, sembrar ${plantName}, ${plantInfo.scientific_name || ''}, ${categoryName}`}
  type="article"
  canonical={`https://plantasyflores.online/calendario/${category}/${plantSlug}/`}
  category={categoryName}
  publishedDate={new Date().toISOString()}
  modifiedDate={new Date().toISOString()}
  noAds={true}
>
  <link rel="stylesheet" href={`/styles/calendar-theme.css?v=${Date.now()}`}>
  
  <div class="plant-calendar-view">
    <div class="modern-header">
      <!-- Breadcrumb Navigation -->
      <CalendarBreadcrumb 
        client:load
        additionalCrumbs={[
          { href: `/calendario/categoria/${category}/`, icon: categoryIcon, text: categoryName },
          { icon: categoryIcon, text: plantIndividualName }
        ]}
      />

      <!-- Hero Section -->
      <PlantHeroHeader 
        plantName={plantName}
        categoryIcon={categoryIcon}
        scientificName={plantInfo.scientific_name}
        plantInfo={plantInfo}
        originFlag={getOriginFlag(plantInfo.origin)}
        articleLink={articleLink}
      />
      
      <!-- Export Button -->
      <div class="export-button-container">
        <HeaderExport 
          client:visible
          exportData={plantExportData}
          exportType="plant"
          title={`Calendario ${plantName}`}
        />
      </div>
    </div>

    <div class="container content-container main-content">
      
      <!-- Introduction Section -->
      <section class="intro-section">
        <div class="intro-content">
          <p>
            Esta <strong>gu√≠a completa de cultivo de {plantName}</strong> te ayuda a planificar la <em>siembra</em>, 
            <em>trasplante</em> y <em>cosecha</em> mes a mes. Este calendario agr√≠cola incluye las mejores fechas 
            para cultivar, cuidados espec√≠ficos y consejos de jardiner√≠a org√°nica adaptados a tu zona clim√°tica 
            y condiciones locales.
          </p>
          <p>
            <strong>C√≥mo usar este calendario:</strong> Las actividades mostradas est√°n organizadas por meses, 
            indicando cu√°ndo sembrar, trasplantar y cosechar. Los iconos de color indican la prioridad 
            de cada tarea, y las temperaturas ayudan a determinar el momento exacto seg√∫n tu zona.
          </p>
        </div>
      </section>

      <!-- Timeline Section -->
      <CalendarTimeline 
        client:visible
        plantName={plantName}
        timelineData={timelineData}
      />

      <!-- Scoville Information (for chili plants) -->
      {scovilleData && (
        <ScovilleCard 
          client:visible
          scovilleData={scovilleData}
        />
      )}

      <div class="details-grid">
        <!-- Plant Details Grid -->
        <PlantDetailsGrid 
          client:visible
          growingConditions={growingConditions}
          harvestData={harvestData}
          plantInfo={plantInfo}
          processedCompanions={processedCompanions}
          processedAvoidPlants={processedAvoidPlants}
          originFlag={getOriginFlag(plantInfo.origin)}
        />

        <!-- Plant Information -->
        <section class="details-card plant-info-card">
          <div class="card-header">
            <h3>üåø Informaci√≥n de la Planta</h3>
          </div>

          <div class="plant-identity">
            {plantInfo.scientific_name && (
              <div class="scientific-name">
                <em>{plantInfo.scientific_name}</em>
              </div>
            )}
            
            {plantInfo.common_names && plantInfo.common_names.length > 0 && (
              <div class="common-names">
                <span class="label">Tambi√©n conocido como:</span>
                <div class="names-list">
                  {plantInfo.common_names.slice(0, 3).map(name => (
                    <span class="name-tag" key={name}>{name}</span>
                  ))}
                </div>
              </div>
            )}
          </div>

          <div class="plant-characteristics">
            <div class="char-grid">
              {plantInfo.family && (
                <div class="char-item family">
                  <div class="char-icon">üèõÔ∏è</div>
                  <div class="char-content">
                    <div class="char-label">Familia Bot√°nica</div>
                    <div class="char-value">{plantInfo.family}</div>
                  </div>
                </div>
              )}

              {plantInfo.type && (
                <div class="char-item type">
                  <div class="char-icon">{
                    plantInfo.type === 'annual' ? 'üìÖ' :
                    plantInfo.type === 'perennial' ? '‚ôæÔ∏è' :
                    plantInfo.type === 'biennial' ? 'üìÜ' :
                    plantInfo.type === 'shrub' ? 'üå≥' :
                    plantInfo.type === 'tree' ? 'üå≤' : 'üå±'
                  }</div>
                  <div class="char-content">
                    <div class="char-label">Ciclo de Vida</div>
                    <div class="char-value">{ui.formatTaskName(plantInfo.type)}</div>
                  </div>
                </div>
              )}

              {plantInfo.origin && (
                <div class="char-item origin">
                  <div class="char-icon flag-icon">{getOriginFlag(plantInfo.origin)}</div>
                  <div class="char-content">
                    <div class="char-label">Origen</div>
                    <div class="char-value">{ui.formatOriginName(plantInfo.origin)}</div>
                  </div>
                </div>
              )}

              {plantCalendar.plant_info?.growth_habit && (
                <div class="char-item growth">
                  <div class="char-icon">{
                    plantCalendar.plant_info.growth_habit === 'indeterminate' ? 'üìà' :
                    plantCalendar.plant_info.growth_habit === 'determinate' ? 'üìä' :
                    plantCalendar.plant_info.growth_habit === 'bushy' ? 'üåø' :
                    plantCalendar.plant_info.growth_habit === 'climbing' ? 'üßó' :
                    plantCalendar.plant_info.growth_habit === 'trailing' ? '„Ä∞Ô∏è' : 'üå±'
                  }</div>
                  <div class="char-content">
                    <div class="char-label">H√°bito de Crecimiento</div>
                    <div class="char-value">{ui.formatTaskName(plantCalendar.plant_info.growth_habit)}</div>
                  </div>
                </div>
              )}
            </div>

            {plantCalendar.plant_info?.mature_size && (
              <div class="size-info">
                <div class="size-header">
                  <div class="size-icon">üìê</div>
                  <span>Tama√±o Maduro</span>
                </div>
                <div class="size-visual">
                  <div class="size-dimension">
                    <div class="dimension-icon">üìè</div>
                    <div class="dimension-info">
                      <span class="dimension-label">Altura</span>
                      <span class="dimension-value">
                        {plantCalendar.plant_info.mature_size.height[0]} - {plantCalendar.plant_info.mature_size.height[1]} cm
                      </span>
                    </div>
                  </div>
                  {plantCalendar.plant_info.mature_size.width && (
                    <div class="size-dimension">
                      <div class="dimension-icon">‚ÜîÔ∏è</div>
                      <div class="dimension-info">
                        <span class="dimension-label">Ancho</span>
                        <span class="dimension-value">
                          {plantCalendar.plant_info.mature_size.width[0]} - {plantCalendar.plant_info.mature_size.width[1]} cm
                        </span>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        </section>

        <!-- Companion Plants -->
        {(processedCompanions.length > 0 || processedAvoidPlants.length > 0) && (
          <section class="details-card companions-card">
            <div class="card-header">
              <h3>ü§ù Plantas Compa√±eras</h3>
              <div class="companion-stats">
                {processedCompanions.length > 0 && (
                  <span class="stat-badge good">
                    <span class="stat-icon">‚úÖ</span>
                    {processedCompanions.length} favorables
                  </span>
                )}
                {processedAvoidPlants.length > 0 && (
                  <span class="stat-badge bad">
                    <span class="stat-icon">‚ùå</span>
                    {processedAvoidPlants.length} evitar
                  </span>
                )}
              </div>
            </div>

            <div class="companion-explanation">
              <p>La plantaci√≥n asociada puede mejorar el crecimiento, repeler plagas y optimizar el uso del espacio en tu huerto.</p>
            </div>

            <div class="companions-grid">
              {processedCompanions.length > 0 && (
                <div class="companion-section good-companions">
                  <div class="section-header good">
                    <div class="section-icon">
                      <span class="icon-bg good">‚úÖ</span>
                    </div>
                    <div class="section-content">
                      <h4>Buenas Compa√±eras</h4>
                      <p>Estas plantas benefician el crecimiento mutuo</p>
                    </div>
                  </div>
                  
                  <div class="companions-grid-container">
                    {processedCompanions.map(companion => (
                      <div class="companion-card good" key={companion.originalName}>
                        {companion.hasCategory ? (
                          <a 
                            href={`/calendario/categoria/${companion.categorySlug}/`}
                            class="companion-link"
                            title={`Ver calendario completo de ${companion.translatedName}`}
                          >
                            <div class="companion-visual">
                              <div class="companion-icon-wrapper">
                                <span class="companion-icon">{ui.getCategoryIcon(companion.categorySlug || 'default')}</span>
                              </div>
                              <div class="companion-info">
                                <span class="companion-name">{companion.translatedName}</span>
                                <span class="companion-status available">
                                  <span class="status-dot"></span>
                                  Gu√≠a disponible
                                </span>
                              </div>
                            </div>
                            <div class="link-arrow">‚Üí</div>
                          </a>
                        ) : (
                          <div class="companion-link disabled">
                            <div class="companion-visual">
                              <div class="companion-icon-wrapper unavailable">
                                <span class="companion-icon">{ui.getCategoryIcon(companion.categorySlug || 'default')}</span>
                              </div>
                              <div class="companion-info">
                                <span class="companion-name">{companion.translatedName}</span>
                                <span class="companion-status unavailable">
                                  <span class="status-dot"></span>
                                  Pr√≥ximamente
                                </span>
                              </div>
                            </div>
                            <div class="unavailable-indicator">‚è≥</div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {processedAvoidPlants.length > 0 && (
                <div class="companion-section bad-companions">
                  <div class="section-header bad">
                    <div class="section-icon">
                      <span class="icon-bg bad">‚ùå</span>
                    </div>
                    <div class="section-content">
                      <h4>Evitar Plantar Cerca</h4>
                      <p>Pueden competir o inhibir el crecimiento</p>
                    </div>
                  </div>
                  
                  <div class="companions-grid-container">
                    {processedAvoidPlants.map(avoid => (
                      <div class="companion-card bad" key={avoid.originalName}>
                        {avoid.hasCategory ? (
                          <a 
                            href={`/calendario/categoria/${avoid.categorySlug}/`}
                            class="companion-link avoid-link"
                            title={`Ver calendario de ${avoid.translatedName} (evitar cerca)`}
                          >
                            <div class="companion-visual">
                              <div class="companion-icon-wrapper avoid">
                                <span class="companion-icon">{ui.getCategoryIcon(avoid.categorySlug || 'default')}</span>
                              </div>
                              <div class="companion-info">
                                <span class="companion-name">{avoid.translatedName}</span>
                                <span class="companion-status available">
                                  <span class="status-dot"></span>
                                  Gu√≠a disponible
                                </span>
                              </div>
                            </div>
                            <div class="link-arrow avoid">‚ö†Ô∏è</div>
                          </a>
                        ) : (
                          <div class="companion-link disabled">
                            <div class="companion-visual">
                              <div class="companion-icon-wrapper unavailable avoid">
                                <span class="companion-icon">{ui.getCategoryIcon(avoid.categorySlug || 'default')}</span>
                              </div>
                              <div class="companion-info">
                                <span class="companion-name">{avoid.translatedName}</span>
                                <span class="companion-status unavailable">
                                  <span class="status-dot"></span>
                                  Pr√≥ximamente
                                </span>
                              </div>
                            </div>
                            <div class="unavailable-indicator">‚è≥</div>
                          </div>
                        )}
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            <div class="companion-tips">
              <div class="tip-icon">üí°</div>
              <div class="tip-content">
                <strong>Consejo:</strong> Mant√©n al menos 30cm de separaci√≥n entre plantas compa√±eras y evita plantar las especies incompatibles a menos de 1 metro de distancia.
              </div>
            </div>
          </section>
        )}

        <!-- Flower Information -->
        <FlowerInfo 
          client:visible
          flowerData={flowerData}
        />

        <!-- Enhanced Nutritional Data -->
        <NutritionalInfo 
          client:visible
          nutritionalData={nutritionalData}
          fruitData={plantCalendar.fruit_data}
        />

        <!-- Additional Harvest Information -->
        <HarvestDetails 
          client:visible
          harvestData={harvestData}
        />
      </div>

      <!-- Back Navigation -->
      <div class="back-navigation">
        <a href={`/calendario/categoria/${category}/`} class="back-link">
          ‚Üê Volver a {categoryName}
        </a>
        <a href="/calendario/" class="back-link">
          Calendario Principal
        </a>
      </div>
    </div>
  </div>

  <!-- Structured Data for Plant Calendar -->
  <script type="application/ld+json" set:html={JSON.stringify(generatePlantCalendarSchema(plantName, plantInfo, categoryName, schemaFAQ))}>
  </script>

</BaseLayout>

<style>
  .plant-calendar-view {
    min-height: 100vh;
    background: #fcfdfe;
  }

  /* Modern Header Styles */
  .modern-header {
    position: relative;
  }

  /* Export Button Container */
  .export-button-container {
    display: flex;
    justify-content: center;
    margin: 1.5rem 0;
    padding: 0 1rem;
  }

  .export-button-container :global(.header-export) {
    background: #fcfdfe;
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: 0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .export-button-container :global(.calendar-export) {
    background: transparent;
  }

  .export-button-container :global(.export-icons) {
    display: flex;
    gap: 0;
  }

  .export-button-container :global(.icon-btn) {
    background: #fcfdfe;
    color: #2d3748;
    border: none;
    border-right: 1px solid #e2e8f0;
    font-weight: 600;
    font-size: 0.9rem;
    padding: 1rem 1.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
    min-width: 80px;
  }

  .export-button-container :global(.icon-btn:first-child) {
    border-radius: 12px 0 0 12px;
  }

  .export-button-container :global(.icon-btn:last-child) {
    border-radius: 0 12px 12px 0;
    border-right: none;
  }

  .export-button-container :global(.icon-btn:hover) {
    background: #f7fafc;
    color: #4a5568;
    transform: translateY(-1px);
  }

  .export-button-container :global(.icon) {
    font-size: 0.9rem;
    font-weight: 700;
  }

  .export-button-container :global(.export-dropdown) {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    margin-top: 0.5rem;
  }

  .export-button-container :global(.export-option) {
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: #2d3748;
    font-weight: 500;
    border-bottom: 1px solid #f7fafc;
    transition: all 0.2s ease;
  }

  .export-button-container :global(.export-option:hover) {
    background: #f7fafc;
    color: #667eea;
  }

  .export-button-container :global(.export-option:last-child) {
    border-bottom: none;
  }

  /* Breadcrumb Navigation */
  .breadcrumb-nav {
    background: #fcfdfe;
    border-bottom: 1px solid #e2e8f0;
    border-radius: 0 0 12px 12px;
    padding: 1rem 0;
  }

  .breadcrumb-container {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .breadcrumb-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #4a5568;
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9rem;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    transition: all 0.3s ease;
  }

  .breadcrumb-link:hover {
    background: #f7fafc;
    color: #2d3748;
  }

  .breadcrumb-separator {
    color: #a0aec0;
    font-weight: 300;
  }

  .breadcrumb-current {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #718096;
    font-weight: 500;
    font-size: 0.9rem;
    padding: 0.5rem 0.75rem;
    background: #f7fafc;
    border-radius: 6px;
  }

  .breadcrumb-icon {
    font-size: 0.9rem;
  }

  .intro-section {
    background: #fcfdfe;
    border-radius: 12px;
    padding: 2rem;
    border: 1px solid #e2e8f0;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border-left: 4px solid #48bb78;
  }

  .intro-content p {
    color: #4a5568;
    line-height: 1.7;
    margin-bottom: 1rem;
    font-size: 1rem;
  }

  .intro-content p:last-child {
    margin-bottom: 0;
  }

  .intro-content strong {
    color: #2d3748;
    font-weight: 600;
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .content-container {
    background-color: #fcfdfe;
  }

  .main-content {
    padding: 2rem 1rem;
  }

  .details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .details-card {
    background: var(--bg-card);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--space-lg);
    box-shadow: var(--shadow-sm);
  }

  .details-card h3 {
    margin-bottom: var(--space-md);
    color: var(--color-text-primary);
    font-size: var(--font-size-lg);
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }

  .conditions-grid {
    display: grid;
    gap: var(--space-md);
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }

  .condition-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-sm);
  }

  .condition-icon {
    font-size: var(--font-size-xl);
    flex-shrink: 0;
  }

  .condition-item strong {
    color: var(--color-text-primary);
    font-weight: 600;
    margin-bottom: var(--space-xs);
    display: block;
  }

  .condition-item p {
    color: var(--color-text-secondary);
    margin: 0;
  }

  .plant-details-grid {
    display: grid;
    gap: var(--space-md);
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  }

  .plant-detail-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-sm);
  }

  .detail-icon {
    font-size: var(--font-size-xl);
    flex-shrink: 0;
  }

  .plant-detail-item strong {
    color: var(--color-text-primary);
    font-weight: 600;
    margin-bottom: var(--space-xs);
    display: block;
  }

  .plant-detail-item p {
    color: var(--color-text-secondary);
    margin: 0;
  }
  
  @media (max-width: 768px) {
    .details-grid {
      grid-template-columns: 1fr;
    }
  }

  .back-navigation {
    display: flex;
    justify-content: center;
    gap: 1rem;
    padding: 2rem 0;
  }

  .back-link {
    background: #48bb78;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: background 0.3s ease;
  }

  .back-link:hover {
    background: #5a67d8;
  }


    .back-navigation {
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }
    
    .back-link {
      width: 100%;
      max-width: 250px;
      text-align: center;
    }

    .breadcrumb-container {
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .breadcrumb-link, .breadcrumb-current {
      font-size: 0.8rem;
      padding: 0.5rem;
    }
  }

  /* Plant Info Card Styles */
  .plant-info-card {
    position: relative;
    overflow: hidden;
  }

  .plant-info-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #10b981 0%, #34d399 50%, #6ee7b7 100%);
  }

  .plant-info-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #e2e8f0;
  }

  .plant-info-card h3 {
    color: #1f2937;
    font-size: 1.35rem;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .difficulty-level {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    border: 2px solid;
  }

  .difficulty-level[data-level="beginner"] {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    color: #166534;
    border-color: #bbf7d0;
  }

  .difficulty-level[data-level="intermediate"] {
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    color: #92400e;
    border-color: #fed7aa;
  }

  .difficulty-level[data-level="advanced"] {
    background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
    color: #991b1b;
    border-color: #fca5a5;
  }

  .difficulty-level[data-level="expert"] {
    background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
    color: #6b21a8;
    border-color: #c4b5fd;
  }

  .difficulty-emoji {
    font-size: 1.2rem;
  }

  .plant-identity {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    border: 1px solid #e2e8f0;
  }

  .scientific-name {
    font-size: 1.1rem;
    color: #374151;
    margin-bottom: 1rem;
    font-weight: 500;
    text-align: center;
    padding: 0.5rem;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 8px;
  }

  .common-names .label {
    display: block;
    font-size: 0.9rem;
    color: #6b7280;
    margin-bottom: 0.75rem;
    font-weight: 500;
  }

  .names-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .name-tag {
    background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
    color: #0c4a6e;
    padding: 0.25rem 0.75rem;
    border-radius: 16px;
    font-size: 0.8rem;
    font-weight: 500;
    border: 1px solid #7dd3fc;
  }

  .char-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .char-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem;
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .char-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--char-gradient);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .char-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    border-color: #cbd5e0;
  }

  .char-item:hover::before {
    opacity: 1;
  }

  .char-item.family {
    --char-gradient: linear-gradient(90deg, #8b5cf6, #a78bfa);
  }

  .char-item.type {
    --char-gradient: linear-gradient(90deg, #06b6d4, #67e8f9);
  }

  .char-item.origin {
    --char-gradient: linear-gradient(90deg, #f59e0b, #fbbf24);
  }

  .char-item.growth {
    --char-gradient: linear-gradient(90deg, #10b981, #34d399);
  }

  .char-icon {
    font-size: 2rem;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border: 2px solid #bae6fd;
  }

  .char-icon.flag-icon {
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    border-color: #fed7aa;
  }

  .char-content {
    flex: 1;
    min-width: 0;
  }

  .char-label {
    font-size: 0.8rem;
    color: #6b7280;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.25rem;
  }

  .char-value {
    font-size: 1rem;
    color: #1f2937;
    font-weight: 600;
    line-height: 1.3;
  }

  .size-info {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border: 1px solid #bbf7d0;
    border-radius: 12px;
    padding: 1.25rem;
  }

  .size-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
    font-weight: 600;
    color: #166534;
  }

  .size-icon {
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #bbf7d0 0%, #86efac 100%);
    border-radius: 50%;
  }

  .size-visual {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .size-dimension {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex: 1;
    min-width: 120px;
  }

  .dimension-icon {
    font-size: 1.25rem;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 8px;
    flex-shrink: 0;
  }

  .dimension-info {
    display: flex;
    flex-direction: column;
  }

  .dimension-label {
    font-size: 0.75rem;
    color: #059669;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .dimension-value {
    font-size: 0.9rem;
    color: #166534;
    font-weight: 700;
  }

  @media (max-width: 768px) {
    .plant-info-card .card-header {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }

    .char-grid {
      grid-template-columns: 1fr;
    }

    .size-visual {
      flex-direction: column;
      gap: 1rem;
    }

    .names-list {
      justify-content: center;
    }
  }

  /* Companions Card Styles */
  .companions-card {
    position: relative;
    overflow: hidden;
  }

  .companions-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #8b5cf6 0%, #a78bfa 50%, #c4b5fd 100%);
  }

  .companion-stats {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .stat-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 16px;
    font-size: 0.8rem;
    font-weight: 600;
    border: 2px solid;
  }

  .stat-badge.good {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    color: #166534;
    border-color: #bbf7d0;
  }

  .stat-badge.bad {
    background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
    color: #991b1b;
    border-color: #fca5a5;
  }

  .stat-icon {
    font-size: 1rem;
  }

  .companion-explanation {
    margin-bottom: 2rem;
    padding: 1.25rem;
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    text-align: center;
  }

  .companion-explanation p {
    margin: 0;
    color: #4b5563;
    font-style: italic;
    line-height: 1.5;
  }

  .companions-grid {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .companion-section {
    background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid #e2e8f0;
    position: relative;
    overflow: hidden;
  }

  .good-companions::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #10b981, #34d399);
  }

  .bad-companions::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #ef4444, #f87171);
  }

  .section-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .section-icon {
    flex-shrink: 0;
  }

  .icon-bg {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-size: 1.5rem;
    font-weight: bold;
  }

  .icon-bg.good {
    background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
    border: 2px solid #86efac;
  }

  .icon-bg.bad {
    background: linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
    border: 2px solid #f87171;
  }

  .section-content h4 {
    margin: 0 0 0.25rem 0;
    color: #1f2937;
    font-size: 1.1rem;
    font-weight: 700;
  }

  .section-content p {
    margin: 0;
    color: #6b7280;
    font-size: 0.9rem;
    line-height: 1.4;
  }

  .companions-grid-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
  }

  .companion-card {
    position: relative;
    transition: all 0.3s ease;
  }

  .companion-link {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .companion-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    border-color: #d1d5db;
  }

  .companion-link.avoid-link:hover {
    background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
    border-color: #fca5a5;
  }

  .companion-link.disabled {
    opacity: 0.7;
    cursor: not-allowed;
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
  }

  .companion-link.disabled:hover {
    transform: none;
    box-shadow: none;
  }

  .companion-visual {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex: 1;
    min-width: 0;
  }

  .companion-icon-wrapper {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    flex-shrink: 0;
    transition: all 0.3s ease;
  }

  .companion-icon-wrapper:not(.unavailable):not(.avoid) {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border: 2px solid #bbf7d0;
  }

  .companion-icon-wrapper.avoid {
    background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
    border: 2px solid #fca5a5;
  }

  .companion-icon-wrapper.unavailable {
    background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    border: 2px solid #d1d5db;
  }

  .companion-icon {
    font-size: 1.5rem;
  }

  .companion-info {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .companion-name {
    font-weight: 600;
    color: #1f2937;
    font-size: 0.95rem;
    text-transform: capitalize;
  }

  .companion-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    font-weight: 500;
  }

  .companion-status.available {
    color: #059669;
  }

  .companion-status.unavailable {
    color: #6b7280;
  }

  .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .companion-status.available .status-dot {
    background: #10b981;
    animation: pulse 2s infinite;
  }

  .companion-status.unavailable .status-dot {
    background: #9ca3af;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .link-arrow {
    font-size: 1.2rem;
    font-weight: bold;
    flex-shrink: 0;
    transition: transform 0.3s ease;
  }

  .companion-link:hover .link-arrow:not(.avoid) {
    transform: translateX(4px);
    color: #10b981;
  }

  .link-arrow.avoid {
    color: #ef4444;
    animation: warning-pulse 2s infinite;
  }

  @keyframes warning-pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .unavailable-indicator {
    font-size: 1.1rem;
    color: #9ca3af;
    flex-shrink: 0;
  }

  .companion-tips {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
    padding: 1.25rem;
    background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
    border: 1px solid #fed7aa;
    border-radius: 12px;
    align-items: flex-start;
  }

  .tip-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .tip-content {
    color: #92400e;
    line-height: 1.5;
    font-size: 0.9rem;
  }

  .tip-content strong {
    color: #78350f;
  }

  @media (max-width: 768px) {
    .companions-card .card-header {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }

    .companion-stats {
      width: 100%;
      justify-content: center;
    }

    .companions-grid-container {
      grid-template-columns: 1fr;
    }

    .section-header {
      flex-direction: column;
      text-align: center;
      gap: 0.75rem;
    }

    .companion-tips {
      flex-direction: column;
      text-align: center;
    }
  }
</style>